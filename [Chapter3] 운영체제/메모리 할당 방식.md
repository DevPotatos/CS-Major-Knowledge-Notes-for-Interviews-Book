## 메모리 할당 방식
새로운 프로세스를 실행시키거나 실행 중인 프로세스가 메모리를 필요로 하는 경우, 운영체제가 물리 메모리를 할당한다. 시작 메모리 위치, 메모리 할당 크기를 기반으로 메모리 할당 방식은 연속 할당과 불연속 할당으로 나뉜다.

### 1. 연속 할당
연속 할당은 메모리에 **'연속적으로'** 공간을 할당하는 것을 의미한다. 이때, **연속**은 프로세스가 할당 받은 메모리가 **한 덩어리로 연속된 공간**이라는 뜻이다. 초기 운영체제에서 사용하였지만 지금은 거의 사용하지 않는다.

연속 할당은 메모리를 미리 나누어 관리하는 **고정 분할 방식**과 매 시점 프로그램의 크기에 맞게 메모리를 분할하여 사용하는 **가변 분할 방식**으로 분류된다.

<br>

### 1) 고정 분할 방식 (fixed partition allocation)
고정 분할 방식은 **메모리를 파티션(partition)이라는 고정된 크기로 미리 나누어 관리하는 방식**이다. 1개의 프로세스는 1개의 파티션을 할당받는다. 따라서, 메모리 전체를 n개의 파티션으로 나눈 경우, 동시에 실행 가능한 프로세스의 개수는 n개이다. 만약 n개의 프로세스 실행 중 새로운 프로세스가 도착하면, 하나의 프로세스가 종료될 때까지 작업 큐에서 대기한다.

메모리를 일정한 크기로 나누어 관리하므로 **메모리 관리가 수월**하다. 하지만 메모리가 미리 나뉘어 있기 때문에 융통성이 없고 **내부 단편화**가 발생한다.

#### 내부 단편화(internal fragmentation)란?
메모리를 나눈 크기보다 프로그램이 작아서 들어가지 못하는 공간이 발생하는 현상이다.

<img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2Fdtf2hi%2FbtqSQ4iSXrH%2FiZ36Q8CtiJ5BEVHBHcvTI0%2Fimg.png" width="400">


<br>

### 2) 가변 분할 방식 (variable parition allocation)
가변 분할 방식은 고정 분할 방식과는 다르게 메모리를 미리 나누는 것이 아닌 **매 시점 프로그램의 크기에 맞게 동적으로 메모리를 나눠 사용하는 방식**이다. 만약 프로세스를 실행하기 위한 메모리가 부족하다면, 필요한 만큼 가용 공간이 생길 때까지 해당 프로세스는 작업 큐에서 대기한다.

내부 단편화는 발생하지 않지만 **외부 단편화**가 발생할 수 있다. 

가변 분할 방식의 종류로는 **최초적합**, **최적적합**, **최악적합**이 존재한다. 최초적합(first-fit)은 위쪽이나 아래쪽부터 시작해서 홀을 찾으면 바로 할당하는 방식이며 알고리즘의 속도는 빠르지만 외부 단편화에 의한 메모리 낭비가 심하다. 최적적합(best-fit)은 프로세스의 크기 이상인 공간 중 가장 작은 홀부터 할당하는 방식이며 홀을 전부 검색해야 하는 부담이 존재한다. 최악적합(worst-fit)은 프로세스의 크기와 가장 많이 차이가 나는 홀에 할당하는 방식으로 최적접합과 마찬가지로 홀을 전부 검색해야 하는 부담이 존재한다.
- **홀(hole)** : 할당할 수 있는 비어 있는 메모리 공간

#### 외부 단편화(external fragmentation)란?
메모리를 나눈 크기보다 프로그램이 커서 들어가지 못하는 공간이 발생하는 현상이다. 

<img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FbGBnWh%2FbtqSLGv6miR%2FShuLfKmJG2JFxrvVWWqvOK%2Fimg.png" width="400">

외부 단편화의 해결법으로는 **압축**, **통합** 기법이 존재한다.

- **압축(compaction)** : 메모리의 모든 내용을 한군데로 몰고 모든 자유 공간들을 다른 한군데로 몰아 홀을 없애는 기법. 프로그램의 재배치 발생.

    <img src="https://mblogthumb-phinf.pstatic.net/MjAxODA5MjhfMjkx/MDAxNTM4MTIyODczMjE1.z2W7mxMyUXhFJYYxTYrYtFtuW0lBnOt8lKqQBwdKNawg.3kAmYg-RXw5N8wrLMe086c_Pwg5u87m9VJn03-iZlXwg.PNG.qbxlvnf11/20180928_172108.png?type=w800" height="200">
- **통합(coalescing)** : 인접한 단편화 영역을 하나의 영역으로 합치는 작업. 프로그램의 재배치 발생 X.

    <img src="https://mblogthumb-phinf.pstatic.net/MjAxODA5MjhfNTAg/MDAxNTM4MTIyODcyMjA2.obYAbMSix1leq9hRAQpUVfS3MIRiKW2CvQUbwUlRmIgg.4NBYMxpguEgkdXwlTpxNVt3j3zA3Nov9EtZzE4IAktAg.PNG.qbxlvnf11/20180928_172044.png?type=w800" height="200">

<br>

### 2. 불연속 할당
불연속 할당은 메모리를 **'불연속적으로'** 공간을 할당하는 것을 의미한다. 이때, **불연속**은 프로세스가 필요한 메모리를 여러 덩어리로 나누어 분산하여 할당한다는 뜻이다. 현대 운영체제가 쓰는 방법으로 페이징, 세그멘테이션, 페이지드 세그멘테이션 기법이 존재한다.

<br>

### 1) 페이징(paging)
<img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2Fyaaix%2FbtrEdsK3PPJ%2F0U6gkxhlTGah6p0kg4mrL1%2Fimg.png" width="500">

페이징은 가상 메모리를 페이지(page)라는 고정 크기로 분할하고 물리 메모리도 페이지와 같은 크기인 프레임(frame)이라는 고정크기로 분할하여 프로세스의 각 페이지를 물리 메모리의 프레임에 불연속적으로 하나씩 할당한다. 

연속적이지 않은 공간도 활용할 수 있기 때문에 **외부 단편화 문제를 해결**할 수 있다. 하지만 프로세스의 크기가 페이지 크기의 배수가 아닌 경우, 마지막 페이지에 내부 단편화가 발생하고 페이지의 크기가 클수록 **내부 단편화가 커지는 문제**가 있다.

<br>

### 2) 세그멘테이션(segmentation)
<img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2F22MDs%2FbtrEcQMrq7W%2FFoKKXCHIBOvfcsu9YvU18k%2Fimg.png" width="500">

세그멘테이션은 프로세스를 서로 크기가 다른 논리 블록 단위인 세그먼트로 분할하여 메모리에 할당하는 방식이다.

프로세스를 이루는 메모리는 코드 영역, 데이터 영역, 스택 영역, 힙 영역으로 이루어지는데 코드와 데이터로 나누거나 코드 내의 작은 함수를 세그먼트로 놓고 나눌 수도 있다.

프로세스가 필요한 메모리 공간만큼 메모리를 할당해주기 때문에 **내부 단편화 문제는 발생하지 않지만** 중간에 메모리를 해제하면 메모리 내 세그먼트 사이에 홀이 생기기 때문에 **외부 단편화 문제가 발생**한다.

<br>

### 3) 페이지드 세그멘테이션(paged segmentation)
페이지드 세그멘테이션은 페이징과 세그멘테이션의 장점을 취한 방식이다. 프로세스를 세그먼트로 분할하지만 세그멘테이션처럼 불규칙한 길이가 아닌 동일한 페이지들의 집합으로 구성한다. 즉, 하나의 세그먼트 크기를 페이지 크기의 배수가 되도록 함으로써 세그멘테이션 기법에서 발생하는 외부 단편화 문제를 해결한다.

<br>

---
### References
https://hapen385.tistory.com/49

https://girawhale.tistory.com/62?category=948070

https://m.blog.naver.com/qbxlvnf11/221367174686

https://cocoon1787.tistory.com/860

https://zangzangs.tistory.com/141

https://superbono-2020.tistory.com/33